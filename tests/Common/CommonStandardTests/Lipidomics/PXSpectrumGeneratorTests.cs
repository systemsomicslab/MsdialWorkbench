using CompMs.Common.DataObj.Property;
using CompMs.Common.Enum;
#if NETSTANDARD || NETFRAMEWORK
using CompMs.Common.Extension;
#endif
using CompMs.Common.Parser;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Linq;

namespace CompMs.Common.Lipidomics.Tests
{
    [TestClass()]
    public class PESpectrumGeneratorTests
    {
        [TestMethod()]
        public void GenerateTest()
        {
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PE, 743.5465235, new PositionLevelChains(acyl1, acyl2));

            var generator = new PESpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+H]+"));

            var expects = new[]
            {
                    142.0252765 ,//Header
                    182.0576723 ,//Gly-C
                    184.0369369 ,//Gly-O
                    265.25259 ,//18:1(9) acyl+
                    //308.2709989 ,//-Header -CH2(Sn1) calc
                    321.278823919  ,//-Header -acylChain -O
                    339.2893886 ,//-Header -acylChain
                    365.2686532 ,//Sn-1-H
                    366.2764782 ,//Sn-1
                    367.2843032 ,//Sn-1+H
                    372.27690 ,//[Precursor]2+
                    379.2843032 ,//Sn-2-H
                    380.2921283 ,//Sn-2
                    381.2999533 ,//Sn-2+H
                    393.2999533 ,//Sn-3-H
                    394.3077783 ,//Sn-3
                    395.3156034 ,//Sn-3+H
                    407.3156034 ,//Sn-4-H
                    408.3234284 ,//Sn-4
                    409.3312534 ,//Sn-4+H
                    421.3312534 ,//Sn-5-H
                    422.3390785 ,//Sn-5
                    423.3469035 ,//Sn-5+H
                    435.3469035 ,//Sn-6-H
                    436.3547285 ,//Sn-6
                    437.3625535 ,//Sn-6+H
                    449.2900946 ,//-CH2(Sn1)
                    449.3625535 ,//Sn-7-H
                    450.3703786 ,//Sn-7
                    451.3782036 ,//Sn-7+H
                    463.3057447 ,// -acylChain -O
                    463.3782036 ,//Sn-8-H
                    464.3860286 ,//Sn-8
                    465.3938537 ,//Sn-8+H
                    476.3860286 ,//Sn-Δ9-H
                    477.3938537 ,//Sn-Δ9
                    478.4016787 ,//Sn-Δ9+H
                    480.3084844 ,//-acylChain
                    489.3938537 ,//Sn-10-H
                    490.4016787 ,//Sn-10
                    491.4095037 ,//Sn-10+H
                    503.4095037 ,//Sn-11-H
                    504.4173288 ,//Sn-11
                    505.4251538 ,//Sn-11+H
                    506.2877489 ,//Sn-1-H
                    507.2955739 ,//Sn-1
                    508.303399  ,//Sn-1+H
                    517.4251538 ,//Sn-12-H
                    518.4329788 ,//Sn-12
                    519.4408039 ,//Sn-12+H
                    520.303399  ,//Sn-2-H
                    521.311224  ,//Sn-2
                    522.319049  ,//Sn-2+H
                    531.4408039 ,//Sn-13-H
                    532.4486289 ,//Sn-13
                    533.4564539 ,//Sn-13+H
                    534.319049  ,//Sn-3-H
                    535.3268741 ,//Sn-3
                    536.3346991 ,//Sn-3+H
                    545.4564539 ,//Sn-14-H
                    546.464279  ,//Sn-14
                    547.472104  ,//Sn-14+H
                    548.3346991 ,//Sn-4-H
                    549.3425241 ,//Sn-4
                    550.3503492 ,//Sn-4+H
                    559.472104  ,//Sn-15-H
                    560.479929  ,//Sn-15
                    561.4877541 ,//Sn-15+H
                    562.3503492 ,//Sn-5-H
                    563.3581742 ,//Sn-5
                    564.3659992 ,//Sn-5+H
                    573.4877541 ,//Sn-16-H
                    574.4955791 ,//Sn-16
                    575.5034041 ,//Sn-16+H
                    576.3659992 ,//Sn-6-H
                    577.3738243 ,//Sn-6
                    578.3816493 ,//Sn-6+H
                    587.5034041 ,//Sn-17-H
                    588.5112292 ,//Sn-17
                    589.5190542 ,//Sn-17+H
                    590.3816493 ,//Sn-7-H
                    591.3894743 ,//Sn-7
                    592.3972994 ,//Sn-7+H
                    603.5347042 ,//-Header
                    604.3972994 ,//Sn-8-H
                    605.4051244 ,//Sn-8
                    606.4129494 ,//Sn-8+H
                    617.4051244 ,//Sn-Δ9-H
                    618.4129494 ,//Sn-Δ9
                    619.4207745 ,//Sn-Δ9+H
                    630.4129494 ,//Sn-10-H
                    631.4207745 ,//Sn-10
                    632.4285995 ,//Sn-10+H
                    644.4285995 ,//Sn-11-H
                    645.4364245 ,//Sn-11
                    646.4442496 ,//Sn-11+H
                    658.4442496 ,//Sn-12-H
                    659.4520746 ,//Sn-12
                    660.4598996 ,//Sn-12+H
                    672.4598996 ,//Sn-13-H
                    673.4677246 ,//Sn-13
                    674.4755497 ,//Sn-13+H
                    686.4755497 ,//Sn-14-H
                    687.4833747 ,//Sn-14
                    688.4911997 ,//Sn-14+H
                    700.4911997 ,//Sn-15-H
                    701.4990248 ,//Sn-15
                    702.5068498 ,//Sn-15+H
                    714.5068498 ,//Sn-16-H
                    715.5146748 ,//Sn-16
                    716.5224999 ,//Sn-16+H
                    728.5224999 ,//Sn-17-H
                    729.5303249 ,//Sn-17
                    730.5381499 ,//Sn-17+H
                    744.5538    ,//Precursor
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }
        [TestMethod()]
        public void GenerateTest_Na()
        {
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PE, 743.5465235, new PositionLevelChains(acyl1, acyl2));

            var generator = new PESpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+Na]+"));

            var expects = new[]
            {
                164.0072207 ,//Header
                204.0396166 ,//Gly-C
                206.0188811 ,//Gly-O
                //330.2529431 ,//-Header -CH2(Sn1) calc
                //343.2607682 ,//-Header -acylChain -O
                //361.2713328 ,//-Header -acylChain
                383.267872 ,//[Precursor]2+
                387.2505974 ,//Sn-1-H
                388.2584224 ,//Sn-1
                389.2662475 ,//Sn-1+H
                401.2662475 ,//Sn-2-H
                402.2740725 ,//Sn-2
                403.2818975 ,//Sn-2+H
                415.2818975 ,//Sn-3-H
                416.2897226 ,//Sn-3
                417.2975476 ,//Sn-3+H
                429.2975476 ,//Sn-4-H
                430.3053726 ,//Sn-4
                431.3131977 ,//Sn-4+H
                443.3131977 ,//Sn-5-H
                444.3210227 ,//Sn-5
                445.3288477 ,//Sn-5+H
                457.3288477 ,//Sn-6-H
                458.3366727 ,//Sn-6
                459.3444978 ,//Sn-6+H
                471.2720389 ,//-CH2(Sn1)
                471.3444978 ,//Sn-7-H
                472.3523228 ,//Sn-7
                473.3601478 ,//Sn-7+H
                484.2798639 ,// -acylChain -O
                485.3601478 ,//Sn-8-H
                486.3679729 ,//Sn-8
                487.3757979 ,//Sn-8+H
                498.3679729 ,//Sn-Δ9-H
                499.3757979 ,//Sn-Δ9
                500.2747785 ,//-acylChain
                500.3836229 ,//Sn-Δ9+H
                511.3757979 ,//Sn-10-H
                512.3836229 ,//Sn-10
                513.391448  ,//Sn-10+H
                525.391448  ,//Sn-11-H
                526.399273  ,//Sn-11
                527.407098  ,//Sn-11+H
                528.2696931 ,//Sn-1-H
                529.2775182 ,//Sn-1
                530.2853432 ,//Sn-1+H
                539.407098  ,//Sn-12-H
                540.4149231 ,//Sn-12
                541.4227481 ,//Sn-12+H
                542.2853432 ,//Sn-2-H
                543.2931682 ,//Sn-2
                544.3009933 ,//Sn-2+H
                553.4227481 ,//Sn-13-H
                554.4305731 ,//Sn-13
                555.4383982 ,//Sn-13+H
                556.3009933 ,//Sn-3-H
                557.3088183 ,//Sn-3
                558.3166433 ,//Sn-3+H
                567.4383982 ,//Sn-14-H
                568.4462232 ,//Sn-14
                569.4540482 ,//Sn-14+H
                570.3166433 ,//Sn-4-H
                571.3244684 ,//Sn-4
                572.3322934 ,//Sn-4+H
                581.4540482 ,//Sn-15-H
                582.4618733 ,//Sn-15
                583.4696983 ,//Sn-15+H
                584.3322934 ,//Sn-5-H
                585.3401184 ,//Sn-5
                586.3479435 ,//Sn-5+H
                595.4696983 ,//Sn-16-H
                596.4775233 ,//Sn-16
                597.4853484 ,//Sn-16+H
                598.3479435 ,//Sn-6-H
                599.3557685 ,//Sn-6
                600.3635935 ,//Sn-6+H
                603.5347042 ,//-Header[M+H]+
                609.4853484 ,//Sn-17-H
                610.4931734 ,//Sn-17
                611.5009984 ,//Sn-17+H
                612.3635935 ,//Sn-7-H
                613.3714186 ,//Sn-7
                614.3792436 ,//Sn-7+H
                625.5166485 ,//-Header
                626.3792436 ,//Sn-8-H
                627.3870686 ,//Sn-8
                628.3948937 ,//Sn-8+H
                639.3870686 ,//Sn-Δ9-H
                640.3948937 ,//Sn-Δ9
                641.4027187 ,//Sn-Δ9+H
                652.3948937 ,//Sn-10-H
                653.4027187 ,//Sn-10
                654.4105437 ,//Sn-10+H
                666.4105437 ,//Sn-11-H
                667.4183688 ,//Sn-11
                668.4261938 ,//Sn-11+H
                680.4261938 ,//Sn-12-H
                681.4340188 ,//Sn-12
                682.4418439 ,//Sn-12+H
                694.4418439 ,//Sn-13-H
                695.4496689 ,//Sn-13
                696.4574939 ,//Sn-13+H
                708.4574939 ,//Sn-14-H
                709.4653189 ,//Sn-14
                710.473144  ,//Sn-14+H
                //721.4784436 ,// Precursor -CH5N -CH2
                722.473144  ,//Sn-15-H
                723.480969  ,//Sn-15
                723.4935  ,//Precursor -C2H5N
                724.488794  ,//Sn-15+H
                736.488794  ,//Sn-16-H
                736.50137 ,//Precursor -CH4N
                737.4966191 ,//Sn-16
                738.5044441 ,//Sn-16+H
                750.5044441 ,//Sn-17-H
                751.5122691 ,//Sn-17
                752.5200942 ,//Sn-17+H
                766.5357442 ,//Precursor
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

        [TestMethod()]
        public void GenerateTest2()
        {
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(18, DoubleBond.CreateFromPosition(12), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PE, 743.5465235, new PositionLevelChains(acyl1, acyl2));

            var generator = new PESpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+H]+"));

            var expects = new[]
            {
                    142.0252765 ,//Header
                    182.0576723 ,//Gly-C
                    184.0369369 ,//Gly-O
                    265.25259 ,//18:1(9) acyl+
                    //308.2709989 ,//-Header -CH2(Sn1) calc
                    321.2788239 ,//-Header -acylChain -O
                    339.2893886 ,//-Header -acylChain
                    365.2686532 ,//Sn1-1-H,//Sn2-1-H,//Sn2-1-H
                    366.2764782 ,//Sn1-1,//Sn2-1
                    367.2843032 ,//Sn1-1+H,//Sn2-1+H
                    372.27689 ,//[Precursor]2+
                    379.2843032 ,//Sn1-2-H,//Sn2-2-H
                    380.2921283 ,//Sn1-2,//Sn2-2
                    381.2999533 ,//Sn1-2+H,//Sn2-2+H
                    393.2999533 ,//Sn1-3-H,//Sn2-3-H
                    394.3077783 ,//Sn1-3,//Sn2-3
                    395.3156034 ,//Sn1-3+H,//Sn2-3+H
                    407.3156034 ,//Sn1-4-H,//Sn2-4-H
                    408.3234284 ,//Sn1-4,//Sn2-4
                    409.3312534 ,//Sn1-4+H,//Sn2-4+H
                    421.3312534 ,//Sn1-5-H,//Sn2-5-H
                    422.3390785 ,//Sn1-5,//Sn2-5
                    423.3469035 ,//Sn1-5+H,//Sn2-5+H
                    435.3469035 ,//Sn1-6-H,//Sn2-6-H
                    436.3547285 ,//Sn1-6,//Sn2-6
                    437.3625535 ,//Sn1-6+H,//Sn2-6+H
                    449.2900946 ,//-CH2(Sn1)
                    449.3625535 ,//Sn1-7-H,//Sn2-7-H
                    450.3703786 ,//Sn1-7,//Sn2-7
                    451.3782036 ,//Sn1-7+H,//Sn2-7+H
                    463.3057447 ,// -acylChain -O
                    463.3782036 ,//Sn1-8-H,//Sn2-8-H
                    464.3860286 ,//Sn1-8,//Sn2-8
                    465.3938537 ,//Sn1-8+H,//Sn2-8+H
                    476.3860286 ,//Sn1-Δ9-H
                    477.3938537 ,//Sn1-Δ9,//Sn2-9-H
                    478.4016787 ,//Sn1-Δ9+H,//Sn2-9
                    479.4095037 ,//Sn2-9+H
                    480.3084844 ,//-acylChain
                    489.3938537 ,//Sn1-10-H
                    490.4016787 ,//Sn1-10
                    491.4095037 ,//Sn1-10+H,//Sn2-10-H
                    492.4173288 ,//Sn2-10
                    493.4251538 ,//Sn2-10+H
                    503.4095037 ,//Sn1-11-H
                    504.4173288 ,//Sn1-11
                    505.4251538 ,//Sn1-11+H,//Sn2-11-H
                    506.2877489 ,//Sn1-1-H,//Sn2-1-H
                    506.4329788 ,//Sn2-11
                    507.2955739 ,//Sn1-1,//Sn2-1
                    507.4408039 ,//Sn2-11+H
                    508.303399  ,//Sn1-1+H,//Sn2-1+H
                    517.4251538 ,//Sn1-12-H
                    518.4329788 ,//Sn1-12,//Sn2-Δ12-H
                    519.4408039 ,//Sn1-12+H,//Sn2-Δ12
                    520.303399  ,//Sn1-2-H,//Sn2-2-H
                    520.4486289 ,//Sn2-Δ12+H
                    521.311224  ,//Sn1-2,//Sn2-2
                    522.319049  ,//Sn1-2+H,//Sn2-2+H
                    531.4408039 ,//Sn1-13-H,//Sn2-13-H
                    532.4486289 ,//Sn1-13,//Sn2-13
                    533.4564539 ,//Sn1-13+H,//Sn2-13+H
                    534.319049  ,//Sn1-3-H,//Sn2-3-H
                    535.3268741 ,//Sn1-3,//Sn2-3
                    536.3346991 ,//Sn1-3+H,//Sn2-3+H
                    545.4564539 ,//Sn1-14-H,//Sn2-14-H
                    546.464279  ,//Sn1-14,//Sn2-14
                    547.472104  ,//Sn1-14+H,//Sn2-14+H
                    548.3346991 ,//Sn1-4-H,//Sn2-4-H
                    549.3425241 ,//Sn1-4,//Sn2-4
                    550.3503492 ,//Sn1-4+H,//Sn2-4+H
                    559.472104  ,//Sn1-15-H,//Sn2-15-H
                    560.479929  ,//Sn1-15,//Sn2-15
                    561.4877541 ,//Sn1-15+H,//Sn2-15+H
                    562.3503492 ,//Sn1-5-H,//Sn2-5-H
                    563.3581742 ,//Sn1-5,//Sn2-5
                    564.3659992 ,//Sn1-5+H,//Sn2-5+H
                    573.4877541 ,//Sn1-16-H,//Sn2-16-H
                    574.4955791 ,//Sn1-16,//Sn2-16
                    575.5034041 ,//Sn1-16+H,//Sn2-16+H
                    576.3659992 ,//Sn1-6-H,//Sn2-6-H
                    577.3738243 ,//Sn1-6,//Sn2-6
                    578.3816493 ,//Sn1-6+H,//Sn2-6+H
                    587.5034041 ,//Sn1-17-H,//Sn2-17-H
                    588.5112292 ,//Sn1-17,//Sn2-17
                    589.5190542 ,//Sn1-17+H,//Sn2-17+H
                    590.3816493 ,//Sn1-7-H,//Sn2-7-H
                    591.3894743 ,//Sn1-7,//Sn2-7
                    592.3972994 ,//Sn1-7+H,//Sn2-7+H
                    603.5347042 ,//-Header
                    604.3972994 ,//Sn1-8-H,//Sn2-8-H
                    605.4051244 ,//Sn1-8,//Sn2-8
                    606.4129494 ,//Sn1-8+H,//Sn2-8+H
                    617.4051244 ,//Sn1-Δ9-H
                    618.4129494 ,//Sn1-Δ9,//Sn2-9-H
                    619.4207745 ,//Sn1-Δ9+H,//Sn2-9
                    620.4285995 ,//Sn2-9+H
                    630.4129494 ,//Sn1-10-H
                    631.4207745 ,//Sn1-10
                    632.4285995 ,//Sn1-10+H,//Sn2-10-H
                    633.4364245 ,//Sn2-10
                    634.4442496 ,//Sn2-10+H
                    644.4285995 ,//Sn1-11-H
                    645.4364245 ,//Sn1-11
                    646.4442496 ,//Sn1-11+H,//Sn2-11-H
                    647.4520746 ,//Sn2-11
                    648.4598996 ,//Sn2-11+H
                    658.4442496 ,//Sn1-12-H
                    659.4520746 ,//Sn1-12,//Sn2-Δ12-H
                    660.4598996 ,//Sn1-12+H,//Sn2-Δ12
                    661.4677246 ,//Sn2-Δ12+H
                    672.4598996 ,//Sn1-13-H,//Sn2-13-H
                    673.4677246 ,//Sn1-13,//Sn2-13
                    674.4755497 ,//Sn1-13+H,//Sn2-13+H
                    686.4755497 ,//Sn1-14-H,//Sn2-14-H
                    687.4833747 ,//Sn1-14,//Sn2-14
                    688.4911997 ,//Sn1-14+H,//Sn2-14+H
                    700.4911997 ,//Sn1-15-H,//Sn2-15-H
                    701.4990248 ,//Sn1-15,//Sn2-15
                    702.5068498 ,//Sn1-15+H,//Sn2-15+H
                    714.5068498 ,//Sn1-16-H,//Sn2-16-H
                    715.5146748 ,//Sn1-16,//Sn2-16
                    716.5224999 ,//Sn1-16+H,//Sn2-16+H
                    728.5224999 ,//Sn1-17-H,//Sn2-17-H
                    729.5303249 ,//Sn1-17,//Sn2-17
                    730.5381499 ,//Sn1-17+H,//Sn2-17+H
                    744.5538    ,//Precursor
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

    }

    [TestClass()]
    public class PSSpectrumGeneratorTests
    {
        [TestMethod()]
        public void GenerateTest_H()
        {
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PS, 787.53633471, new PositionLevelChains(acyl1, acyl2));

            var generator = new PSSpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+H]+"));

            var expects = new[]
            {
                186.01749   ,//Header
                226.05066   ,//Gly-C
                228.0253    ,//Gly-O
                265.25259 ,//18:1(9) acyl+
                308.2637    ,//-Header -CH2(SN1) calc
                322.27924   ,//-Header -acylChain -O
                339.29147   ,//-Header -acylChain
                365.2686489 ,//Sn1-1-H
                366.2764739 ,//Sn1-1
                367.284299  ,//Sn1-1+H
                379.284299  ,//Sn1-2-H
                380.292124  ,//Sn1-2
                381.299949  ,//Sn1-2+H
                393.299949  ,//Sn1-3-H
                394.3077741 ,//Sn1-3
                395.3155991 ,//Sn1-3+H
                407.3155991 ,//Sn1-4-H
                408.3234241 ,//Sn1-4
                409.3312492 ,//Sn1-4+H
                421.3312492 ,//Sn1-5-H
                422.3390742 ,//Sn1-5
                423.3468992 ,//Sn1-5+H
                435.3468992 ,//Sn1-6-H
                436.3547243 ,//Sn1-6
                437.3625493 ,//Sn1-6+H
                449.3625493 ,//Sn1-7-H
                450.3703743 ,//Sn1-7
                451.3781994 ,//Sn1-7+H
                463.3781994 ,//Sn1-8-H
                464.3860244 ,//Sn1-8
                465.3938494 ,//Sn1-8+H
                476.3860244 ,//Sn1-Δ9-H
                477.3938494 ,//Sn1-Δ9
                478.4016745 ,//Sn1-Δ9+H
                489.3938494 ,//Sn1-10-H
                490.4016745 ,//Sn1-10
                491.4094995 ,//Sn1-10+H
                493.27316   ,//-CH2(SN1)
                503.4094995 ,//Sn1-11-H
                504.4173245 ,//Sn1-11
                505.4251496 ,//Sn1-11+H
                507.30017   ,// -acylChain -O
                517.4251496 ,//Sn1-12-H
                518.4329746 ,//Sn1-12
                519.4407996 ,//Sn1-12+H
                524.29663   ,// -acylChain
                531.4407996 ,//Sn1-13-H
                532.4486246 ,//Sn1-13
                533.4564497 ,//Sn1-13+H
                545.4564497 ,//Sn1-14-H
                546.4642747 ,//Sn1-14
                547.4720997 ,//Sn1-14+H
                559.4720997 ,//Sn1-15-H
                560.4799248 ,//Sn1-15
                561.4877498 ,//Sn1-15+H
                573.4877498 ,//Sn1-16-H
                574.4955748 ,//Sn1-16
                575.5033999 ,//Sn1-16+H
                587.5033999 ,//Sn1-17-H
                588.5112249 ,//Sn1-17
                589.5190499 ,//Sn1-17+H
                603.54462   ,//Precursor -C3H8NO6P
                743.54816   ,//Precursor -CHO2
                770.53375   ,//Precursor -H2O
                788.54663   ,//Precursor
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

        [TestMethod()]
        public void GenerateTest_Na()
        {
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PS, 787.53633471, new PositionLevelChains(acyl1, acyl2));

            var generator = new PSSpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+Na]+"));

            var expects = new[]
            {
                207.99814,// Header   
                248.02944,// Gly-C   
                250.00871,// Gly-O   
                515.26185,// -CH2(Sn1)   
                529.2775,// -18:1(9)-O -18:1(9)-O  
                546.28024,// -18:1(9) -18:1(9)  
                572.2595,// 18:1(9) C1-H 18:1(9) C1-H
                573.26733,// 18:1(9) C1 18:1(9) C1
                574.27515,// 18:1(9) C1+H 18:1(9) C1+H
                586.27515,// 18:1(9) C2-H 18:1(9) C2-H
                587.28298,// 18:1(9) C2 18:1(9) C2
                588.2908,// 18:1(9) C2+H 18:1(9) C2+H
                600.2908,// 18:1(9) C3-H 18:1(9) C3-H
                601.29863,// 18:1(9) C3 18:1(9) C3
                602.30645,// 18:1(9) C3+H 18:1(9) C3+H
                603.53469,// Precursor -C3H8NO6P -Na+ 
                614.30645,// 18:1(9) C4-H 18:1(9) C4-H
                615.31428,// 18:1(9) C4 18:1(9) C4
                616.3221,// 18:1(9) C4+H 18:1(9) C4+H
                625.51663,// Precursor -C3H8NO6P  
                628.3221,// 18:1(9) C5-H 18:1(9) C5-H
                629.32993,// 18:1(9) C5 18:1(9) C5
                630.33775,// 18:1(9) C5+H 18:1(9) C5+H
                642.33775,// 18:1(9) C6-H 18:1(9) C6-H
                643.34558,// 18:1(9) C6 18:1(9) C6
                644.3534,// 18:1(9) C6+H 18:1(9) C6+H
                656.3534,// 18:1(9) C7-H 18:1(9) C7-H
                657.36123,// 18:1(9) C7 18:1(9) C7
                658.36905,// 18:1(9) C7+H 18:1(9) C7+H
                670.36905,// 18:1(9) C8-H 18:1(9) C8-H
                671.37688,// 18:1(9) C8 18:1(9) C8
                672.3847,// 18:1(9) C8+H 18:1(9) C8+H
                683.37688,// 18:1(9) C9-H 18:1(9) C9-H
                684.3847,// 18:1(9) C9 18:1(9) C9
                685.39253,// 18:1(9) C9+H 18:1(9) C9+H
                696.3847,// 18:1(9) C10-H 18:1(9) C10-H
                697.39253,// 18:1(9) C10 18:1(9) C10
                698.40035,// 18:1(9) C10+H 18:1(9) C10+H
                710.40035,// 18:1(9) C11-H 18:1(9) C11-H
                711.40818,// 18:1(9) C11 18:1(9) C11
                712.416,// 18:1(9) C11+H 18:1(9) C11+H
                723.49353,// Precursor -C3H5NO2  
                724.416,// 18:1(9) C12-H 18:1(9) C12-H
                725.42383,// 18:1(9) C12 18:1(9) C12
                726.43166,// 18:1(9) C12+H 18:1(9) C12+H
                738.43166,// 18:1(9) C13-H 18:1(9) C13-H
                739.43948,// 18:1(9) C13 18:1(9) C13
                740.44731,// 18:1(9) C13+H 18:1(9) C13+H
                752.44731,// 18:1(9) C14-H 18:1(9) C14-H
                753.45513,// 18:1(9) C14 18:1(9) C14
                754.46296,// 18:1(9) C14+H 18:1(9) C14+H
                765.5279,// Precursor -CHO2  
                766.46296,// 18:1(9) C15-H 18:1(9) C15-H
                767.47078,// 18:1(9) C15 18:1(9) C15
                768.47861,// 18:1(9) C15+H 18:1(9) C15+H
                780.47861,// 18:1(9) C16-H 18:1(9) C16-H
                781.48643,// 18:1(9) C16 18:1(9) C16
                782.49426,// 18:1(9) C16+H 18:1(9) C16+H
                794.49426,// 18:1(9) C17-H 18:1(9) C17-H
                795.50208,// 18:1(9) C17 18:1(9) C17
                796.50991,// 18:1(9) C17+H 18:1(9) C17+H
                810.52556,// Precursor   

            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

    }

    [TestClass()]
    public class PGSpectrumGeneratorTests
    {
        [TestMethod()]
        public void GenerateTest_H()
        {
            //PG 18:1(9)_22:6(4,7,10,13,16,19)
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(22, DoubleBond.CreateFromPosition(4, 7, 10, 13, 16, 19), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PG, 820.525435677, new PositionLevelChains(acyl1, acyl2));

            var generator = new PGSpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+H]+"));

            var expects = new[]
            {
                    173.0215,// Header   
                    213.0528,// Gly-C   
                    215.03206,// Gly-O   
                    265.25259,// 18:1(9) acyl  
                    311.23694,// 22:6(4,7,10,13,16,19) acyl  
                    354.25588,// -Header -CH2(SN1)  
                    365.26864,// 22:6(4,7,10,13,16,19) C1-H_p3  
                    366.27646,// 22:6(4,7,10,13,16,19) C1_p3  
                    367.28429,// 22:6(4,7,10,13,16,19) C1+H_p3  
                    379.28429,// 22:6(4,7,10,13,16,19) C2-H_p3  
                    380.29211,// 22:6(4,7,10,13,16,19) C2_p3  
                    381.29994,// 22:6(4,7,10,13,16,19) C2+H_p3  
                    393.29994,// 22:6(4,7,10,13,16,19) C3-H_p3  
                    394.30776,// 22:6(4,7,10,13,16,19) C3_p3  
                    395.31559,// 22:6(4,7,10,13,16,19) C3+H_p3  
                    406.30776,// 22:6(4,7,10,13,16,19) C4-H_p3  
                    407.31559,// 22:6(4,7,10,13,16,19) C4_p3  
                    408.32341,// 22:6(4,7,10,13,16,19) C4+H_p3  
                    411.25299,// 18:1(9) C1-H  
                    412.26081,// 18:1(9) C1  
                    413.26864,// 18:1(9) C1+H  
                    419.31559,// 22:6(4,7,10,13,16,19) C5-H_p3  
                    420.32341,// 22:6(4,7,10,13,16,19) C5_p3  
                    421.33124,// 22:6(4,7,10,13,16,19) C5+H_p3  
                    425.26864,// 18:1(9) C2-H  
                    426.27646,// 18:1(9) C2  
                    427.28429,// 18:1(9) C2+H  
                    433.33124,// 22:6(4,7,10,13,16,19) C6-H_p3  
                    434.33906,// 22:6(4,7,10,13,16,19) C6_p3  
                    435.34689,// 22:6(4,7,10,13,16,19) C6+H_p3  
                    439.28429,// 18:1(9) C3-H  
                    440.29211,// 18:1(9) C3  
                    441.29994,// 18:1(9) C3+H  
                    446.33906,// 22:6(4,7,10,13,16,19) C7-H_p3  
                    447.34689,// 22:6(4,7,10,13,16,19) C7_p3  
                    448.35471,// 22:6(4,7,10,13,16,19) C7+H_p3  
                    453.29994,// 18:1(9) C4-H  
                    454.30776,// 18:1(9) C4  
                    455.31559,// 18:1(9) C4+H  
                    459.34689,// 22:6(4,7,10,13,16,19) C8-H_p3  
                    460.35471,// 22:6(4,7,10,13,16,19) C8_p3  
                    461.36254,// 22:6(4,7,10,13,16,19) C8+H_p3  
                    467.31559,// 18:1(9) C5-H  
                    468.32341,// 18:1(9) C5  
                    469.33124,// 18:1(9) C5+H  
                    473.36254,// 22:6(4,7,10,13,16,19) C9-H_p3  
                    474.37036,// 22:6(4,7,10,13,16,19) C9_p3  
                    475.37819,// 22:6(4,7,10,13,16,19) C9+H_p3  
                    481.33124,// 18:1(9) C6-H  
                    482.33906,// 18:1(9) C6  
                    483.34689,// 18:1(9) C6+H  
                    486.37036,// 22:6(4,7,10,13,16,19) C10-H_p3  
                    487.37819,// 22:6(4,7,10,13,16,19) C10_p3  
                    488.38601,// 22:6(4,7,10,13,16,19) C10+H_p3  
                    493.29303,// -6:22(4,7,10,13,16,19)-H2O   
                    495.34689,// 18:1(9) C7-H  
                    496.35471,// 18:1(9) C7  
                    497.36254,// 18:1(9) C7+H  
                    499.37819,// 22:6(4,7,10,13,16,19) C11-H_p3  
                    500.38601,// 22:6(4,7,10,13,16,19) C11_p3  
                    501.39384,// 22:6(4,7,10,13,16,19) C11+H_p3  
                    508.25899,// -H2O -CH2(SN1)  
                    509.36254,// 18:1(9) C8-H  
                    510.37036,// 18:1(9) C8  
                    511.3036,// -6:22(4,7,10,13,16,19)   
                    511.37819,// 18:1(9) C8+H  
                    513.39384,// 22:6(4,7,10,13,16,19) C12-H_p3  
                    514.40166,// 22:6(4,7,10,13,16,19) C12_p3  
                    515.40949,// 22:6(4,7,10,13,16,19) C12+H_p3  
                    522.37036,// 18:1(9) C9-H  
                    523.37819,// 18:1(9) C9  
                    524.38601,// 18:1(9) C9+H  
                    526.26956,// -CH2(SN1)   
                    526.40166,// 22:6(4,7,10,13,16,19) C13-H_p3  
                    527.40949,// 22:6(4,7,10,13,16,19) C13_p3  
                    528.41731,// 22:6(4,7,10,13,16,19) C13+H_p3  
                    535.37819,// 18:1(9) C10-H  
                    536.38601,// 18:1(9) C10  
                    537.39384,// 18:1(9) C10+H  
                    539.27738,// -1:18(9)-H2O   
                    539.40949,// 22:6(4,7,10,13,16,19) C14-H_p3  
                    540.41731,// 22:6(4,7,10,13,16,19) C14_p3  
                    541.42514,// 22:6(4,7,10,13,16,19) C14+H_p3  
                    549.39384,// 18:1(9) C11-H  
                    550.40166,// 18:1(9) C11  
                    551.40949,// 18:1(9) C11+H  
                    553.42514,// 22:6(4,7,10,13,16,19) C15-H_p3  
                    554.43296,// 22:6(4,7,10,13,16,19) C15_p3  
                    555.44079,// 22:6(4,7,10,13,16,19) C15+H_p3  
                    557.28795,// -1:18(9)   
                    563.40949,// 18:1(9) C12-H  
                    564.41731,// 18:1(9) C12  
                    565.42514,// 18:1(9) C12+H  
                    566.43296,// 22:6(4,7,10,13,16,19) C16-H_p3  
                    567.44079,// 22:6(4,7,10,13,16,19) C16_p3  
                    568.44861,// 22:6(4,7,10,13,16,19) C16+H_p3  
                    577.42514,// 18:1(9) C13-H  
                    578.43296,// 18:1(9) C13  
                    579.44079,// 18:1(9) C13+H, 22:6(4,7,10,13,16,19) C17-H_p3
                    580.44861,// 22:6(4,7,10,13,16,19) C17_p3  
                    581.45644,// 22:6(4,7,10,13,16,19) C17+H_p3  
                    591.44079,// 18:1(9) C14-H  
                    592.44861,// 18:1(9) C14  
                    593.45644,// 18:1(9) C14+H, 22:6(4,7,10,13,16,19) C18-H_p3
                    594.46426,// 22:6(4,7,10,13,16,19) C18_p3  
                    595.47209,// 22:6(4,7,10,13,16,19) C18+H_p3  
                    605.45644,// 18:1(9) C15-H  
                    606.46426,// 18:1(9) C15, 22:6(4,7,10,13,16,19) C19-H_p3
                    607.47209,// 18:1(9) C15+H, 22:6(4,7,10,13,16,19) C19_p3
                    608.47991,// 22:6(4,7,10,13,16,19) C19+H_p3  
                    619.47209,// 18:1(9) C16-H, 22:6(4,7,10,13,16,19) C20-H_p3
                    620.47991,// 18:1(9) C16, 22:6(4,7,10,13,16,19) C20_p3
                    621.48774,// 18:1(9) C16+H, 22:6(4,7,10,13,16,19) C20+H_p3
                    633.48774,// 18:1(9) C17-H, 22:6(4,7,10,13,16,19) C21-H_p3
                    634.49556,// 18:1(9) C17, 22:6(4,7,10,13,16,19) C21_p3
                    635.50339,// 18:1(9) C17+H, 22:6(4,7,10,13,16,19) C21+H_p3
                    649.51959,// Precursor -C3H9O6P  
                    747.49593,// Precursor -C3H6O2  
                    821.53271,// Precursor   
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }
        [TestMethod()]
        public void GenerateTest_NH4()
        {
            //PG 18:1(9)_22:6(4,7,10,13,16,19)
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(22, DoubleBond.CreateFromPosition(4, 7, 10, 13, 16, 19), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PG, 820.525435677, new PositionLevelChains(acyl1, acyl2));

            var generator = new PGSpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+NH4]+"));

            var expects = new[]
            {
                    173.02095,// Header   
                    213.05225,// Gly-C   
                    215.03152,// Gly-O   
                    265.25259,// 18:1(9) acyl  
                    311.23694,// 22:6(4,7,10,13,16,19) acyl  
                    321.27881,// -Header -22:6(4,7,10,13,16,19)-H2O  
                    339.28937,// -Header -22:6(4,7,10,13,16,19)  
                    354.25533,// -Header -CH2(Sn1)  
                    365.26864,// 22:6(4,7,10,13,16,19) C1-H_p3  
                    366.27646,// 22:6(4,7,10,13,16,19) C1_p3  
                    367.26316,// -Header -18:1(9)-H2O  
                    367.28429,// 22:6(4,7,10,13,16,19) C1+H_p3  
                    379.28429,// 22:6(4,7,10,13,16,19) C2-H_p3  
                    380.29211,// 22:6(4,7,10,13,16,19) C2_p3  
                    381.29994,// 22:6(4,7,10,13,16,19) C2+H_p3  
                    385.27372,// -Header -18:1(9)  
                    393.29994,// 22:6(4,7,10,13,16,19) C3-H_p3  
                    394.30776,// 22:6(4,7,10,13,16,19) C3_p3  
                    395.31559,// 22:6(4,7,10,13,16,19) C3+H_p3  
                    406.30776,// 22:6(4,7,10,13,16,19) C4-H_p3  
                    407.31559,// 22:6(4,7,10,13,16,19) C4_p3  
                    408.32341,// 22:6(4,7,10,13,16,19) C4+H_p3  
                    411.25299,// 18:1(9) C1-H  
                    412.26081,// 18:1(9) C1  
                    413.26864,// 18:1(9) C1+H  
                    419.31559,// 22:6(4,7,10,13,16,19) C5-H_p3  
                    420.32341,// 22:6(4,7,10,13,16,19) C5_p3  
                    421.33124,// 22:6(4,7,10,13,16,19) C5+H_p3  
                    425.26864,// 18:1(9) C2-H  
                    426.27646,// 18:1(9) C2  
                    427.28429,// 18:1(9) C2+H  
                    433.33124,// 22:6(4,7,10,13,16,19) C6-H_p3  
                    434.33906,// 22:6(4,7,10,13,16,19) C6_p3  
                    435.34689,// 22:6(4,7,10,13,16,19) C6+H_p3  
                    439.28429,// 18:1(9) C3-H  
                    440.29211,// 18:1(9) C3  
                    441.29994,// 18:1(9) C3+H  
                    446.33906,// 22:6(4,7,10,13,16,19) C7-H_p3  
                    447.34689,// 22:6(4,7,10,13,16,19) C7_p3  
                    448.35471,// 22:6(4,7,10,13,16,19) C7+H_p3  
                    453.29994,// 18:1(9) C4-H  
                    454.30776,// 18:1(9) C4  
                    455.31559,// 18:1(9) C4+H  
                    459.34689,// 22:6(4,7,10,13,16,19) C8-H_p3  
                    460.35471,// 22:6(4,7,10,13,16,19) C8_p3  
                    461.36254,// 22:6(4,7,10,13,16,19) C8+H_p3  
                    467.31559,// 18:1(9) C5-H  
                    468.32341,// 18:1(9) C5  
                    469.33124,// 18:1(9) C5+H  
                    473.36254,// 22:6(4,7,10,13,16,19) C9-H_p3  
                    474.37036,// 22:6(4,7,10,13,16,19) C9_p3  
                    475.37819,// 22:6(4,7,10,13,16,19) C9+H_p3  
                    481.33124,// 18:1(9) C6-H  
                    482.33906,// 18:1(9) C6  
                    483.34689,// 18:1(9) C6+H  
                    486.37036,// 22:6(4,7,10,13,16,19) C10-H_p3  
                    487.37819,// 22:6(4,7,10,13,16,19) C10_p3  
                    488.38601,// 22:6(4,7,10,13,16,19) C10+H_p3  
                    493.29248,// -22:6(4,7,10,13,16,19)-H2O   
                    495.34689,// 18:1(9) C7-H  
                    496.35471,// 18:1(9) C7  
                    497.36254,// 18:1(9) C7+H  
                    499.37819,// 22:6(4,7,10,13,16,19) C11-H_p3  
                    500.38601,// 22:6(4,7,10,13,16,19) C11_p3  
                    501.39384,// 22:6(4,7,10,13,16,19) C11+H_p3  
                    508.25844,// -H2O -CH2(Sn1)  
                    509.36254,// 18:1(9) C8-H  
                    510.37036,// 18:1(9) C8  
                    511.30305,// -22:6(4,7,10,13,16,19)   
                    511.37819,// 18:1(9) C8+H  
                    513.39384,// 22:6(4,7,10,13,16,19) C12-H_p3  
                    514.40166,// 22:6(4,7,10,13,16,19) C12_p3  
                    515.40949,// 22:6(4,7,10,13,16,19) C12+H_p3  
                    522.37036,// 18:1(9) C9-H  
                    523.37819,// 18:1(9) C9  
                    524.38601,// 18:1(9) C9+H  
                    526.26901,// -CH2(Sn1)   
                    526.40166,// 22:6(4,7,10,13,16,19) C13-H_p3  
                    527.40949,// 22:6(4,7,10,13,16,19) C13_p3  
                    528.41731,// 22:6(4,7,10,13,16,19) C13+H_p3  
                    535.37819,// 18:1(9) C10-H  
                    536.38601,// 18:1(9) C10  
                    537.39384,// 18:1(9) C10+H  
                    539.27683,// -18:1(9)-H2O   
                    539.40949,// 22:6(4,7,10,13,16,19) C14-H_p3  
                    540.41731,// 22:6(4,7,10,13,16,19) C14_p3  
                    541.42514,// 22:6(4,7,10,13,16,19) C14+H_p3  
                    549.39384,// 18:1(9) C11-H  
                    550.40166,// 18:1(9) C11  
                    551.40949,// 18:1(9) C11+H  
                    553.42514,// 22:6(4,7,10,13,16,19) C15-H_p3  
                    554.43296,// 22:6(4,7,10,13,16,19) C15_p3  
                    555.44079,// 22:6(4,7,10,13,16,19) C15+H_p3  
                    557.2874,// -18:1(9)   
                    563.40949,// 18:1(9) C12-H  
                    564.41731,// 18:1(9) C12  
                    565.42514,// 18:1(9) C12+H  
                    566.43296,// 22:6(4,7,10,13,16,19) C16-H_p3  
                    567.44079,// 22:6(4,7,10,13,16,19) C16_p3  
                    568.44861,// 22:6(4,7,10,13,16,19) C16+H_p3  
                    577.42514,// 18:1(9) C13-H  
                    578.43296,// 18:1(9) C13  
                    579.44079,// 18:1(9) C13+H, 22:6(4,7,10,13,16,19) C17-H_p3
                    580.44861,// 22:6(4,7,10,13,16,19) C17_p3  
                    581.45644,// 22:6(4,7,10,13,16,19) C17+H_p3  
                    591.44079,// 18:1(9) C14-H  
                    592.44861,// 18:1(9) C14  
                    593.45644,// 18:1(9) C14+H, 22:6(4,7,10,13,16,19) C18-H_p3
                    594.46426,// 22:6(4,7,10,13,16,19) C18_p3  
                    595.47209,// 22:6(4,7,10,13,16,19) C18+H_p3  
                    605.45644,// 18:1(9) C15-H  
                    606.46426,// 18:1(9) C15, 22:6(4,7,10,13,16,19) C19-H_p3
                    607.47209,// 18:1(9) C15+H, 22:6(4,7,10,13,16,19) C19_p3
                    608.47991,// 22:6(4,7,10,13,16,19) C19+H_p3  
                    619.47209,// 18:1(9) C16-H, 22:6(4,7,10,13,16,19) C20-H_p3
                    620.47991,// 18:1(9) C16, 22:6(4,7,10,13,16,19) C20_p3
                    621.48774,// 18:1(9) C16+H, 22:6(4,7,10,13,16,19) C20+H_p3
                    633.48774,// 18:1(9) C17-H, 22:6(4,7,10,13,16,19) C21-H_p3
                    634.49556,// 18:1(9) C17, 22:6(4,7,10,13,16,19) C21_p3
                    635.50339,// 18:1(9) C17+H, 22:6(4,7,10,13,16,19) C21+H_p3
                    649.51904,// Precursor -C3H9O6P  
                    764.52248,// Precursor -C3H6O2  
                    820.5487,// Precursor -H2O  
                    821.53271,// [M+H]+   
                    838.55926,// Precursor   

            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }
        [TestMethod()]
        public void GenerateTest_Na()
        {
            //PG 18:1(9)_22:6(4,7,10,13,16,19)
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(22, DoubleBond.CreateFromPosition(4, 7, 10, 13, 16, 19), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PG, 820.525435677, new PositionLevelChains(acyl1, acyl2));

            var generator = new PGSpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+Na]+"));

            var expects = new[]
            {
                    195.00344,// Header   
                    235.03474,// Gly-C   
                    237.01401,// Gly-O   
                    265.25259,// 18:1(9) acyl  
                    311.23694,// 22:6(4,7,10,13,16,19) acyl  
                    376.23782,// -Header -CH2(Sn1)  
                    421.75733,// Precursor2+   
                    515.27497,// -22:6(4,7,10,13,16,19)-H2O   
                    530.24093,// -H2O -CH2(Sn1)  
                    533.28554,// -22:6(4,7,10,13,16,19)   
                    548.2515,// -CH2(Sn1)   
                    559.26426,// 22:6(4,7,10,13,16,19) C1-H_p3  
                    560.27208,// 22:6(4,7,10,13,16,19) C1_p3  
                    561.25932,// -18:1(9)-H2O   
                    561.27991,// 22:6(4,7,10,13,16,19) C1+H_p3  
                    573.27991,// 22:6(4,7,10,13,16,19) C2-H_p3  
                    574.28773,// 22:6(4,7,10,13,16,19) C2_p3  
                    575.29556,// 22:6(4,7,10,13,16,19) C2+H_p3  
                    579.26989,// -18:1(9)   
                    587.29556,// 22:6(4,7,10,13,16,19) C3-H_p3  
                    588.30338,// 22:6(4,7,10,13,16,19) C3_p3  
                    589.31121,// 22:6(4,7,10,13,16,19) C3+H_p3  
                    600.30338,// 22:6(4,7,10,13,16,19) C4-H_p3  
                    601.31121,// 22:6(4,7,10,13,16,19) C4_p3  
                    602.31903,// 22:6(4,7,10,13,16,19) C4+H_p3  
                    605.24861,// 18:1(9) C1-H  
                    606.25643,// 18:1(9) C1  
                    607.26426,// 18:1(9) C1+H  
                    613.31121,// 22:6(4,7,10,13,16,19) C5-H_p3  
                    614.31903,// 22:6(4,7,10,13,16,19) C5_p3  
                    615.32686,// 22:6(4,7,10,13,16,19) C5+H_p3  
                    619.26426,// 18:1(9) C2-H  
                    620.27208,// 18:1(9) C2  
                    621.27991,// 18:1(9) C2+H  
                    627.32686,// 22:6(4,7,10,13,16,19) C6-H_p3  
                    628.33468,// 22:6(4,7,10,13,16,19) C6_p3  
                    629.34251,// 22:6(4,7,10,13,16,19) C6+H_p3  
                    633.27991,// 18:1(9) C3-H  
                    634.28773,// 18:1(9) C3  
                    635.29556,// 18:1(9) C3+H  
                    640.33468,// 22:6(4,7,10,13,16,19) C7-H_p3  
                    641.34251,// 22:6(4,7,10,13,16,19) C7_p3  
                    642.35033,// 22:6(4,7,10,13,16,19) C7+H_p3  
                    647.29556,// 18:1(9) C4-H  
                    648.30338,// 18:1(9) C4  
                    649.31121,// 18:1(9) C4+H  
                    653.34251,// 22:6(4,7,10,13,16,19) C8-H_p3  
                    654.35033,// 22:6(4,7,10,13,16,19) C8_p3  
                    655.35816,// 22:6(4,7,10,13,16,19) C8+H_p3  
                    661.31121,// 18:1(9) C5-H  
                    662.31903,// 18:1(9) C5  
                    663.32686,// 18:1(9) C5+H  
                    667.35816,// 22:6(4,7,10,13,16,19) C9-H_p3  
                    668.36598,// 22:6(4,7,10,13,16,19) C9_p3  
                    669.37381,// 22:6(4,7,10,13,16,19) C9+H_p3  
                    671.50153,// Precursor -C3H9O6P  
                    675.32686,// 18:1(9) C6-H  
                    676.33468,// 18:1(9) C6  
                    677.34251,// 18:1(9) C6+H  
                    680.36598,// 22:6(4,7,10,13,16,19) C10-H_p3  
                    681.37381,// 22:6(4,7,10,13,16,19) C10_p3  
                    682.38163,// 22:6(4,7,10,13,16,19) C10+H_p3  
                    689.34251,// 18:1(9) C7-H  
                    690.35033,// 18:1(9) C7  
                    691.35816,// 18:1(9) C7+H  
                    693.37381,// 22:6(4,7,10,13,16,19) C11-H_p3  
                    694.38163,// 22:6(4,7,10,13,16,19) C11_p3  
                    695.38946,// 22:6(4,7,10,13,16,19) C11+H_p3  
                    703.35816,// 18:1(9) C8-H  
                    704.36598,// 18:1(9) C8  
                    705.37381,// 18:1(9) C8+H  
                    707.38946,// 22:6(4,7,10,13,16,19) C12-H_p3  
                    708.39728,// 22:6(4,7,10,13,16,19) C12_p3  
                    709.40511,// 22:6(4,7,10,13,16,19) C12+H_p3  
                    716.36598,// 18:1(9) C9-H  
                    717.37381,// 18:1(9) C9  
                    718.38163,// 18:1(9) C9+H  
                    720.39728,// 22:6(4,7,10,13,16,19) C13-H_p3  
                    721.40511,// 22:6(4,7,10,13,16,19) C13_p3  
                    722.41293,// 22:6(4,7,10,13,16,19) C13+H_p3  
                    729.37381,// 18:1(9) C10-H  
                    730.38163,// 18:1(9) C10  
                    731.38946,// 18:1(9) C10+H  
                    733.40511,// 22:6(4,7,10,13,16,19) C14-H_p3  
                    734.41293,// 22:6(4,7,10,13,16,19) C14_p3  
                    735.42076,// 22:6(4,7,10,13,16,19) C14+H_p3  
                    743.38946,// 18:1(9) C11-H  
                    744.39728,// 18:1(9) C11  
                    745.40511,// 18:1(9) C11+H  
                    747.42076,// 22:6(4,7,10,13,16,19) C15-H_p3  
                    748.42858,// 22:6(4,7,10,13,16,19) C15_p3  
                    749.43641,// 22:6(4,7,10,13,16,19) C15+H_p3  
                    757.40511,// 18:1(9) C12-H  
                    758.41293,// 18:1(9) C12  
                    759.42076,// 18:1(9) C12+H  
                    760.42858,// 22:6(4,7,10,13,16,19) C16-H_p3  
                    761.43641,// 22:6(4,7,10,13,16,19) C16_p3  
                    762.44423,// 22:6(4,7,10,13,16,19) C16+H_p3  
                    769.47788,// Precursor -C3H6O2  
                    771.42076,// 18:1(9) C13-H  
                    772.42858,// 18:1(9) C13  
                    773.43641,// 18:1(9) C13+H, 22:6(4,7,10,13,16,19) C17-H_p3
                    774.44423,// 22:6(4,7,10,13,16,19) C17_p3  
                    775.45206,// 22:6(4,7,10,13,16,19) C17+H_p3  
                    785.43641,// 18:1(9) C14-H  
                    786.44423,// 18:1(9) C14  
                    787.45206,// 18:1(9) C14+H, 22:6(4,7,10,13,16,19) C18-H_p3
                    788.45988,// 22:6(4,7,10,13,16,19) C18_p3  
                    789.46771,// 22:6(4,7,10,13,16,19) C18+H_p3  
                    799.45206,// 18:1(9) C15-H  
                    800.45988,// 18:1(9) C15, 22:6(4,7,10,13,16,19) C19-H_p3
                    801.46771,// 18:1(9) C15+H, 22:6(4,7,10,13,16,19) C19_p3
                    802.47553,// 22:6(4,7,10,13,16,19) C19+H_p3  
                    813.46771,// 18:1(9) C16-H, 22:6(4,7,10,13,16,19) C20-H_p3
                    814.47553,// 18:1(9) C16, 22:6(4,7,10,13,16,19) C20_p3
                    815.48336,// 18:1(9) C16+H, 22:6(4,7,10,13,16,19) C20+H_p3
                    827.48336,// 18:1(9) C17-H, 22:6(4,7,10,13,16,19) C21-H_p3
                    828.49118,// 18:1(9) C17, 22:6(4,7,10,13,16,19) C21_p3
                    829.49901,// 18:1(9) C17+H, 22:6(4,7,10,13,16,19) C21+H_p3
                    843.51466,// Precursor   
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

    }

    [TestClass()]
    public class PISpectrumGeneratorTests
    {
        [TestMethod()]
        public void GenerateTest_H()
        {
            //PI 18:0_20:4(5,8,11,14)
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(), new Oxidized(0));
            var acyl2 = new AcylChain(20, DoubleBond.CreateFromPosition(5, 8, 11, 14), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PI, 886.557129731, new PositionLevelChains(acyl1, acyl2));

            var generator = new PISpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+H]+"));

            var expects = new[]
            {
                    261.03754,// Header   
                    301.06884,// Gly-C   
                    303.04811,// Gly-O   
                    323.29501,// -C6H13O9P -20:4(5,8,11,14)-H2O  
                    341.30557,// -C6H13O9P -20:4(5,8,11,14)  
                    343.26371,// -C6H13O9P -18:0-H2O  
                    361.27427,// -C6H13O9P -18:0  
                    367.28429,// 20:4(5,8,11,14) C1-H_p3  
                    368.29211,// 20:4(5,8,11,14) C1_p3  
                    369.29994,// 20:4(5,8,11,14) C1+H_p3  
                    381.29994,// 20:4(5,8,11,14) C2-H_p3  
                    382.30776,// 20:4(5,8,11,14) C2_p3  
                    383.31559,// 20:4(5,8,11,14) C2+H_p3  
                    387.25299,// 18:0 C1-H  
                    388.26081,// 18:0 C1  
                    389.26864,// 18:0 C1+H  
                    395.31559,// 20:4(5,8,11,14) C3-H_p3  
                    396.32341,// 20:4(5,8,11,14) C3_p3  
                    397.33124,// 20:4(5,8,11,14) C3+H_p3  
                    401.26864,// 18:0 C2-H  
                    402.27646,// 18:0 C2  
                    403.28429,// 18:0 C2+H  
                    409.33124,// 20:4(5,8,11,14) C4-H_p3  
                    410.33906,// 20:4(5,8,11,14) C4_p3  
                    411.34689,// 20:4(5,8,11,14) C4+H_p3  
                    415.28429,// 18:0 C3-H  
                    416.29211,// 18:0 C3  
                    417.29994,// 18:0 C3+H  
                    422.33906,// 20:4(5,8,11,14) C5-H_p3  
                    423.34689,// 20:4(5,8,11,14) C5_p3  
                    424.35471,// 20:4(5,8,11,14) C5+H_p3  
                    429.29994,// 18:0 C4-H  
                    430.30776,// 18:0 C4  
                    431.31559,// 18:0 C4+H  
                    435.34689,// 20:4(5,8,11,14) C6-H_p3  
                    436.35471,// 20:4(5,8,11,14) C6_p3  
                    437.36254,// 20:4(5,8,11,14) C6+H_p3  
                    443.31559,// 18:0 C5-H  
                    444.32341,// 18:0 C5  
                    445.33124,// 18:0 C5+H  
                    449.36254,// 20:4(5,8,11,14) C7-H_p3  
                    450.37036,// 20:4(5,8,11,14) C7_p3  
                    451.37819,// 20:4(5,8,11,14) C7+H_p3  
                    457.33124,// 18:0 C6-H  
                    458.33906,// 18:0 C6  
                    459.34689,// 18:0 C6+H  
                    462.37036,// 20:4(5,8,11,14) C8-H_p3  
                    463.37819,// 20:4(5,8,11,14) C8_p3  
                    464.38601,// 20:4(5,8,11,14) C8+H_p3  
                    471.34689,// 18:0 C7-H  
                    472.35471,// 18:0 C7  
                    473.36254,// 18:0 C7+H  
                    475.37819,// 20:4(5,8,11,14) C9-H_p3  
                    476.38601,// 20:4(5,8,11,14) C9_p3  
                    477.39384,// 20:4(5,8,11,14) C9+H_p3  
                    485.36254,// 18:0 C8-H  
                    486.37036,// 18:0 C8  
                    487.37819,// 18:0 C8+H  
                    489.39384,// 20:4(5,8,11,14) C10-H_p3  
                    490.40166,// 20:4(5,8,11,14) C10_p3  
                    491.40949,// 20:4(5,8,11,14) C10+H_p3  
                    499.37819,// 18:0 C9-H  
                    500.38601,// 18:0 C9  
                    501.39384,// 18:0 C9+H  
                    502.40166,// 20:4(5,8,11,14) C11-H_p3  
                    503.40949,// 20:4(5,8,11,14) C11_p3  
                    504.41731,// 20:4(5,8,11,14) C11+H_p3  
                    513.39384,// 18:0 C10-H  
                    514.40166,// 18:0 C10  
                    515.40949,// 18:0 C10+H, 20:4(5,8,11,14) C12-H_p3
                    516.41731,// 20:4(5,8,11,14) C12_p3  
                    517.42514,// 20:4(5,8,11,14) C12+H_p3  
                    527.40949,// 18:0 C11-H  
                    528.41731,// 18:0 C11  
                    529.42514,// 18:0 C11+H, 20:4(5,8,11,14) C13-H_p3
                    530.43296,// 20:4(5,8,11,14) C13_p3  
                    531.44079,// 20:4(5,8,11,14) C13+H_p3  
                    541.42514,// 18:0 C12-H  
                    542.43296,// 18:0 C12, 20:4(5,8,11,14) C14-H_p3
                    543.44079,// 18:0 C12+H, 20:4(5,8,11,14) C14_p3
                    544.44861,// 20:4(5,8,11,14) C14+H_p3  
                    555.44079,// 18:0 C13-H, 20:4(5,8,11,14) C15-H_p3
                    556.44861,// 18:0 C13, 20:4(5,8,11,14) C15_p3
                    557.45644,// 18:0 C13+H, 20:4(5,8,11,14) C15+H_p3
                    569.45644,// 18:0 C14-H, 20:4(5,8,11,14) C16-H_p3
                    570.46426,// 18:0 C14, 20:4(5,8,11,14) C16_p3
                    571.47209,// 18:0 C14+H, 20:4(5,8,11,14) C16+H_p3
                    583.32472,// -20:4(5,8,11,14)-H2O   
                    583.47209,// 18:0 C15-H, 20:4(5,8,11,14) C17-H_p3
                    584.47991,// 18:0 C15, 20:4(5,8,11,14) C17_p3
                    585.48774,// 18:0 C15+H, 20:4(5,8,11,14) C17+H_p3
                    590.2856,// -CH2(Sn1)   
                    597.48774,// 18:0 C16-H, 20:4(5,8,11,14) C18-H_p3
                    598.49556,// 18:0 C16, 20:4(5,8,11,14) C18_p3
                    599.50339,// 18:0 C16+H, 20:4(5,8,11,14) C18+H_p3
                    601.33529,// -20:4(5,8,11,14)   
                    603.29342,// -18:0-H2O   
                    611.50339,// 18:0 C17-H, 20:4(5,8,11,14) C19-H_p3
                    612.51121,// 18:0 C17, 20:4(5,8,11,14) C19_p3
                    613.51904,// 18:0 C17+H, 20:4(5,8,11,14) C19+H_p3
                    621.30399,// -18:0   
                    627.53469,// Precursor -Header  
                    725.51158,// Precursor -C6H10O5  
                    887.56441,// Precursor   

            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

        [TestMethod()]
        public void GenerateTest_NH4()
        {
            //PI 18:0_20:4(5,8,11,14)
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(), new Oxidized(0));
            var acyl2 = new AcylChain(20, DoubleBond.CreateFromPosition(5, 8, 11, 14), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PI, 886.557129731, new PositionLevelChains(acyl1, acyl2));

            var generator = new PISpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+NH4]+"));

            var expects = new[]
            {
                    261.037,// Header   
                    301.0683,// Gly-C   
                    303.04756,// Gly-O   
                    323.29446,// -C6H13O9P -20:4(5,8,11,14)-H2O  
                    341.30502,// -C6H13O9P -20:4(5,8,11,14)  
                    343.26316,// -C6H13O9P -18:0-H2O  
                    361.27372,// -C6H13O9P -18:0  
                    367.28429,// 20:4(5,8,11,14) C1-H_p3  
                    368.29211,// 20:4(5,8,11,14) C1_p3  
                    369.29994,// 20:4(5,8,11,14) C1+H_p3  
                    381.29994,// 20:4(5,8,11,14) C2-H_p3  
                    382.30776,// 20:4(5,8,11,14) C2_p3  
                    383.31559,// 20:4(5,8,11,14) C2+H_p3  
                    387.25299,// 18:0 C1-H  
                    388.26081,// 18:0 C1  
                    389.26864,// 18:0 C1+H  
                    395.31559,// 20:4(5,8,11,14) C3-H_p3  
                    396.32341,// 20:4(5,8,11,14) C3_p3  
                    397.33124,// 20:4(5,8,11,14) C3+H_p3  
                    401.26864,// 18:0 C2-H  
                    402.27646,// 18:0 C2  
                    403.28429,// 18:0 C2+H  
                    409.33124,// 20:4(5,8,11,14) C4-H_p3  
                    410.33906,// 20:4(5,8,11,14) C4_p3  
                    411.34689,// 20:4(5,8,11,14) C4+H_p3  
                    415.28429,// 18:0 C3-H  
                    416.29211,// 18:0 C3  
                    417.29994,// 18:0 C3+H  
                    422.33906,// 20:4(5,8,11,14) C5-H_p3  
                    423.34689,// 20:4(5,8,11,14) C5_p3  
                    424.35471,// 20:4(5,8,11,14) C5+H_p3  
                    429.29994,// 18:0 C4-H  
                    430.30776,// 18:0 C4  
                    431.31559,// 18:0 C4+H  
                    435.34689,// 20:4(5,8,11,14) C6-H_p3  
                    436.35471,// 20:4(5,8,11,14) C6_p3  
                    437.36254,// 20:4(5,8,11,14) C6+H_p3  
                    443.31559,// 18:0 C5-H  
                    444.32341,// 18:0 C5  
                    445.33124,// 18:0 C5+H  
                    449.36254,// 20:4(5,8,11,14) C7-H_p3  
                    450.37036,// 20:4(5,8,11,14) C7_p3  
                    451.37819,// 20:4(5,8,11,14) C7+H_p3  
                    457.33124,// 18:0 C6-H  
                    458.33906,// 18:0 C6  
                    459.34689,// 18:0 C6+H  
                    462.37036,// 20:4(5,8,11,14) C8-H_p3  
                    463.37819,// 20:4(5,8,11,14) C8_p3  
                    464.38601,// 20:4(5,8,11,14) C8+H_p3  
                    471.34689,// 18:0 C7-H  
                    472.35471,// 18:0 C7  
                    473.36254,// 18:0 C7+H  
                    475.37819,// 20:4(5,8,11,14) C9-H_p3  
                    476.38601,// 20:4(5,8,11,14) C9_p3  
                    477.39384,// 20:4(5,8,11,14) C9+H_p3  
                    485.36254,// 18:0 C8-H  
                    486.37036,// 18:0 C8  
                    487.37819,// 18:0 C8+H  
                    489.39384,// 20:4(5,8,11,14) C10-H_p3  
                    490.40166,// 20:4(5,8,11,14) C10_p3  
                    491.40949,// 20:4(5,8,11,14) C10+H_p3  
                    499.37819,// 18:0 C9-H  
                    500.38601,// 18:0 C9  
                    501.39384,// 18:0 C9+H  
                    502.40166,// 20:4(5,8,11,14) C11-H_p3  
                    503.40949,// 20:4(5,8,11,14) C11_p3  
                    504.41731,// 20:4(5,8,11,14) C11+H_p3  
                    513.39384,// 18:0 C10-H  
                    514.40166,// 18:0 C10  
                    515.40949,// 18:0 C10+H, 20:4(5,8,11,14) C12-H_p3
                    516.41731,// 20:4(5,8,11,14) C12_p3  
                    517.42514,// 20:4(5,8,11,14) C12+H_p3  
                    527.40949,// 18:0 C11-H  
                    528.41731,// 18:0 C11  
                    529.42514,// 18:0 C11+H, 20:4(5,8,11,14) C13-H_p3
                    530.43296,// 20:4(5,8,11,14) C13_p3  
                    531.44079,// 20:4(5,8,11,14) C13+H_p3  
                    541.42514,// 18:0 C12-H  
                    542.43296,// 18:0 C12, 20:4(5,8,11,14) C14-H_p3
                    543.44079,// 18:0 C12+H, 20:4(5,8,11,14) C14_p3
                    544.44861,// 20:4(5,8,11,14) C14+H_p3  
                    555.44079,// 18:0 C13-H, 20:4(5,8,11,14) C15-H_p3
                    556.44861,// 18:0 C13, 20:4(5,8,11,14) C15_p3
                    557.45644,// 18:0 C13+H, 20:4(5,8,11,14) C15+H_p3
                    569.45644,// 18:0 C14-H, 20:4(5,8,11,14) C16-H_p3
                    570.46426,// 18:0 C14, 20:4(5,8,11,14) C16_p3
                    571.47209,// 18:0 C14+H, 20:4(5,8,11,14) C16+H_p3
                    583.32418,// -20:4(5,8,11,14)-H2O   
                    583.47209,// 18:0 C15-H, 20:4(5,8,11,14) C17-H_p3
                    584.47991,// 18:0 C15, 20:4(5,8,11,14) C17_p3
                    585.48774,// 18:0 C15+H, 20:4(5,8,11,14) C17+H_p3
                    590.28505,// -CH2(Sn1)   
                    597.48774,// 18:0 C16-H, 20:4(5,8,11,14) C18-H_p3
                    598.49556,// 18:0 C16, 20:4(5,8,11,14) C18_p3
                    599.50339,// 18:0 C16+H, 20:4(5,8,11,14) C18+H_p3
                    601.33474,// -20:4(5,8,11,14)   
                    603.29288,// -18:0-H2O   
                    611.50339,// 18:0 C17-H, 20:4(5,8,11,14) C19-H_p3
                    612.51121,// 18:0 C17, 20:4(5,8,11,14) C19_p3
                    613.51904,// 18:0 C17+H, 20:4(5,8,11,14) C19+H_p3
                    621.30344,// -18:0   
                    627.53469,// Precursor -Header  
                    742.53813,// Precursor -C6H10O5  
                    887.56441,// [M+H]+   
                    904.59096,// Precursor   

            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }

    }

    [TestClass()]
    public class PASpectrumGeneratorTests
    {
        [TestMethod()]
        public void GenerateTest()
        {
            //standard PA 18:1(n-9)/18:1(n-9)
            var acyl1 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var acyl2 = new AcylChain(18, DoubleBond.CreateFromPosition(9), new Oxidized(0));
            var lipid = new Lipid(LbmClass.PA, 700.504306309, new PositionLevelChains(acyl1, acyl2));

            var generator = new PASpectrumGenerator();
            var scan = lipid.GenerateSpectrum(generator, AdductIon.GetAdductIon("[M+H]+"));

            var expects = new[]
            {
                    139.01358   ,//Gly-C
                    140.993 ,//Gly-O
                    173.0124997 ,//C3H9O6P
                    265.25259 ,//18:1(9) acyl+
                    307.2632696 ,// Header -CH2(SN1) calc
                    321.27924   ,// -Header -acylChain -O
                    339.29147   ,// -Header -acylChain
                    365.2687489 ,//Sn1-1-H
                    366.2765739 ,//Sn1-1
                    367.284399  ,//Sn1-1+H
                    379.284399  ,//Sn1-2-H
                    380.292224  ,//Sn1-2
                    381.300049  ,//Sn1-2+H
                    393.300049  ,//Sn1-3-H
                    394.3078741 ,//Sn1-3
                    395.3156991 ,//Sn1-3+H
                    405.2400696 ,// -CH2(SN1) calc
                    407.3156991 ,//Sn1-4-H
                    408.3235241 ,//Sn1-4
                    409.3313492 ,//Sn1-4+H
                    419.2556    ,// -acylChain -O
                    421.3313492 ,//Sn1-5-H
                    422.3391742 ,//Sn1-5
                    423.3469992 ,//Sn1-5+H
                    435.3469992 ,//Sn1-6-H
                    436.3548243 ,//Sn1-6
                    437.2662844 ,// -acylChain calc
                    437.3626493 ,//Sn1-6+H
                    449.3626493 ,//Sn1-7-H
                    450.3704743 ,//Sn1-7
                    451.3782994 ,//Sn1-7+H
                    463.3782994 ,//Sn1-8-H
                    464.3861244 ,//Sn1-8
                    465.3939494 ,//Sn1-8+H
                    476.3861244 ,//Sn1-Δ9-H
                    477.3939494 ,//Sn1-Δ9
                    478.4017745 ,//Sn1-Δ9+H
                    489.3939494 ,//Sn1-10-H
                    490.4017745 ,//Sn1-10
                    491.4095995 ,//Sn1-10+H
                    503.4095995 ,//Sn1-11-H
                    504.4174245 ,//Sn1-11
                    505.4252496 ,//Sn1-11+H
                    517.4252496 ,//Sn1-12-H
                    518.4330746 ,//Sn1-12
                    519.4408996 ,//Sn1-12+H
                    531.4408996 ,//Sn1-13-H
                    532.4487246 ,//Sn1-13
                    533.4565497 ,//Sn1-13+H
                    545.4565497 ,//Sn1-14-H
                    546.4643747 ,//Sn1-14
                    547.4721997 ,//Sn1-14+H
                    559.4721997 ,//Sn1-15-H
                    560.4800248 ,//Sn1-15
                    561.4878498 ,//Sn1-15+H
                    573.4878498 ,//Sn1-16-H
                    574.4956748 ,//Sn1-16
                    575.5034999 ,//Sn1-16+H
                    587.5034999 ,//Sn1-17-H
                    588.5113249 ,//Sn1-17
                    589.5191499 ,//Sn1-17+H
                    603.5349    ,//Header loss
                    701.5116    ,//[M+H]+
            };

            scan.Spectrum.ForEach(spec => System.Console.WriteLine($"Mass {spec.Mass}, Intensity {spec.Intensity}, Comment {spec.Comment}"));
            foreach ((var expect, var actual) in expects.ZipInternal(scan.Spectrum.Select(spec => spec.Mass)))
            {
                Assert.AreEqual(expect, actual, 0.01d);
            }
        }
    }

}